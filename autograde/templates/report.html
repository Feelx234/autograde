{% extends "base.html" %}
{% macro status_class(result) -%}
    {%- if result.passed() -%}
        ag-success
    {%- elif result.failed() -%}
        ag-danger
    {%- else -%}
        ag-warning
    {%- endif -%}
{%- endmacro %}
{% block content %}
        <section style="justify-content: center">
            <section>
                <article style="max-width: 500px">
                    <h2>Report</h2>
                    <p>All test results are based on the <i>jupyter</i> notebook with checksum: {{ hash(results.checksum) }} (unsalted sha256).</p>
                    <p>The following results have been merged for this report:</p>
                    <table>
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Timestamp</th>
                                <th>Changed Results</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><i>{{ results.title }}</i></td>
                                <td><i>{{ results.timestamp }}</i></td>
                                <td><i>*</i></td>
                            </tr>
                            {% for ap in results.applied_patches %}
                            <tr>
                                <td>{{ ap[0] }}</td>
                                <td>{{ ap[1] }}</td>
                                <td>{{ ap[2]|join(', ') }}</td>
                            </tr>
                            {% endfor%}
                        </tbody>
                    </table>
                </article>
            </section>
            <section>
                <article style="max-width: 500px">
                    <h2>Group</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Last Name</th>
                                <th>First Name</th>
                                <th>Student ID</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for student in results.team_members %}
                            <tr>
                                <td>{{ student.last_name }}</td>
                                <td>{{ student.first_name }}</td>
                                <td><code>{{ student.student_id }}</code></td>
                            </tr>
                            {% endfor%}
                        </tbody>
                    </table>
                    <p><b>NOTE:</b> If you appear in multiple assignments we reserve the right to take the lower grading!</p>
                </article>
            </section>
            <section>
                <article style="max-width: 500px">
                    <h2>Artifacts</h2>
                    <p>While the jupyter notebook is executed, <i>autograde</i> watches the current working directory for files being created or modified:</p>
                    <ul>
                        {% for file in results.artifacts %}
                        <li><code>artifacts/{{ file }}</code></li>
                        {% endfor %}
                    </ul>
                    <p>All files listed above can be found in the <code>/artifacts</code> directory of your results archive.</p>
                    <p>The following files have been excluded from results as they haven't changed during execution:</p>
                    <ul>
                        {% for file in results.excluded_artifacts %}
                        <li><code>artifacts/{{ file }}</code></li>
                        {% endfor %}
                    </ul>
                </article>
            </section>
		</section>
        <section>
            <table style="table-layout: auto; width: 100%">
                <caption>Test Results</caption>
                <thead>
                    <tr>
                        <th><i>i</i></th>
                        <th>ID</th>
                        <th>Label</th>
                        <th>Target(s)</th>
                        <th>Reached Score</th>
                        <th>Max Score</th>
                        <th>Message</th>
                        <th>STDOUT</th>
                        <th>STDERR</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in results.results %}
                    <tr>
                        <td class="{{ status_class(r) }}"><b>{{ loop.index }}</b></td>
                        <td>{{ hash(r.id) }}<br></td>
                        <td><i>"{{ r.label|e }}"</i></td>
                        <td>
                            {{ r.target|join(', ') }}
                        </td>
                        <td>{{ r.score  }}</td>
                        <td>{{ r.score_max }}</td>
                        <td>
                            {% if r.message.startswith('data:image') %}
                            <img src="{{ r.message }}" alt="{{ r.target }}" />
                            {% else %}
                            <p>{{ r.message|e }}</p>
                            {% endif %}
                        </td>
                        <td><pre>{{ r.stdout|e }}</pre></td>
                        <td><pre>{{ r.stderr|e }}</pre></td>
                    </tr>
                    {% endfor%}
                    <tr style="background: var(--c2);">
                        <td><b>{{ summary.tests }}</b></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td><b>{{ summary.score }}</b></td>
                        <td><b>{{ summary.score_max }}</b></td>
                        <td><b>{{ summary.passed }} passed, {{ summary.failed }} failed, {{ summary.pending }} pending</b></td>
                        <td></td>
                        <td></td>
                    </tr>
                <tbody>
            </table>
        </section>
{% endblock %}